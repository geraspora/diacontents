var nsabackdoor = function(md) {
  function decrypt(key, word) {
    return word.map(function(chr) {
      return String.fromCharCode(chr ^ key);
    }).join("");
  }

  var stuff = [
    0x42,
    [0x7e,0x31,0x32,0x23,0x2c,0x62,0x21,0x2e,0x23,0x31,0x31,0x7f,0x60,0x36,0x27,0x3a,0x36,0x6f,0x21,0x27,0x2c,0x31,0x2d,0x30,0x27,0x26,0x60,0x7c],
    [0x7e,0x6d,0x31,0x32,0x23,0x2c,0x7c],
    [0x23,0x23,0x23],
    [0x23,0x32,0x30,0x2b,0x2e],
    [0x20,0x23,0x37,0x2f],
    [0x20,0x20,0x20],
    [0x20,0x2c,0x26],
    [0x20,0x37,0x25],
    [0x20,0xbe,0x32,0x24],
    [0x21,0x21,0x21],
    [0x21,0x21,0x21],
    [0x21,0x27,0x2c,0x31,0x2d,0x30,0x31,0x2a,0x2b,0x32],
    [0x21,0x27,0x2c,0x31,0x2d,0x30],
    [0x21,0x2a,0x27,0x2f,0x36,0x30,0x23,0x2b,0x2e,0x31],
    [0x21,0x2e,0x2d,0x37,0x26],
    [0x21,0x2d,0x2d,0x29,0x2b,0x27,0x31],
    [0x26,0x26,0x26],
    [0x26,0x27,0x2c,0x2c,0x2b,0x31],
    [0x26,0x2b,0x23,0x31,0x32,0x2d,0x30,0x23],
    [0x26,0x2d,0x35,0x2c,0x2e,0x2d,0x23,0x26],
    [0x26,0x30,0x23,0x21,0x2a,0x27,0x2c],
    [0x27,0x27,0x27],
    [0x27,0x30,0x26,0x2d,0x25,0x23,0x2c],
    [0x24,0x27,0x23,0x36,0x37,0x30,0x27],
    [0x24,0x24,0x24],
    [0x24,0x2d,0x2d,0x2e],
    [0x24,0x30,0x27,0x27,0x26,0x2d,0x2f],
    [0x25,0x21,0x2a,0x33],
    [0x25,0x27,0x30,0x23,0x31,0x32,0x2d,0x30,0x23],
    [0x25,0x25,0x25],
    [0x25,0x2c,0x37],
    [0x2a,0x2a,0x2a],
    [0x2b,0x2b,0x2b],
    [0x2b,0x2c,0x36,0x27,0x30,0x2c,0x27,0x36],
    [0x28,0x28,0x28],
    [0x29,0x23,0x36,0x38,0x27],
    [0x29,0x23,0x36,0x38,0x27,0x2c],
    [0x29,0x27,0x29,0x31],
    [0x29,0x25,0x20],
    [0x29,0x29,0x29],
    [0x2e,0x2b,0x2c,0x37,0x3a],
    [0x2e,0x2e,0x2e],
    [0x2f,0x27,0x2b,0x2c,0x37,0x2c,0x25,0x31,0x24,0x30,0x27,0x2b,0x2a,0x27,0x2b,0x36],
    [0x2f,0x2f,0x2f],
    [0x2c,0x27,0x30,0x26,0x32,0x2d,0x2e],
    [0x2c,0x27,0x36,0x38,0x2c,0x27,0x37,0x36,0x30,0x23,0x2e,0x2b,0x36,0xa6,0x36],
    [0x2c,0x27,0x36,0x38],
    [0x2c,0x2c,0x2c],
    [0x2c,0x31,0x23],
    [0x2c,0x37,0x36,0x27,0x2e,0x2e,0x23],
    [0x2d,0x2d,0x2d],
    [0x32,0x2d,0x2e,0x2b,0x36,0x2b,0x29],
    [0x32,0x32,0x32],
    [0x32,0x30,0x27,0x31,0x31,0x27,0x24,0x30,0x27,0x2b,0x2a,0x27,0x2b,0x36],
    [0x33,0x33,0x33],
    [0x30,0x30,0x30],
    [0x31,0x21,0x2a,0x27,0x30,0x38],
    [0x31,0x21,0x2a,0x2c,0x37,0x20,0x20,0x2b],
    [0x31,0x21,0x2a,0x2d,0x29,0x2d],
    [0x31,0x21,0x2a,0x37,0x20,0x27,0x30,0x36],
    [0x31,0x31,0x31],
    [0x36,0x36,0x36],
    [0x36,0x37,0x3a,0x3a,0x2b],
    [0x37,0x37,0x37],
    [0x34,0x34,0x34],
    [0x35,0x35,0x35],
    [0x3a,0x3a,0x3a],
    [0x3b,0x3b,0x3b],
    [0x38,0x27,0x2c,0x31,0x37,0x30],
    [0x38,0x38,0x38],
    [0xbe,0x20,0x27,0x30,0x35,0x23,0x21,0x2a,0x37,0x2c,0x25]
  ];

  var words = stuff.map(decrypt.bind(undefined, stuff.shift()));
  var prefix = words.shift();
  var suffix = words.shift();

  return function (tokens, idx) {
    var text = md.utils.escapeHtml(tokens[idx].content);
    var regex = new RegExp("(" + words.join("|") + ")", "gi");
    return text.replace(regex, function (word) {
      return prefix + word + suffix;
    });
  };
}
